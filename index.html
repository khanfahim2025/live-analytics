<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0, private">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Last-Modified" content="0">
    <meta http-equiv="ETag" content="0">
    <meta name="cache-control" content="no-cache">
    <meta name="expires" content="0">
    <meta name="pragma" content="no-cache">
    <title>üåê Live Analytics Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
          <link rel="stylesheet" href="styles.css?v=2024.1.9">
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-content">
                <div class="header-left">
                    <h1><i class="fas fa-chart-line"></i> Live Analytics Dashboard</h1>
                    <p>Real-time monitoring for websites and microsites</p>
                </div>
                <div class="header-right">
                    <div class="connection-status">
                        <span class="status-indicator connected"></span>
                        <span>Connected</span>
                    </div>
                    <button class="refresh-btn" onclick="refreshData()">
                        <i class="fas fa-sync-alt"></i> Refresh Data
                    </button>
                </div>
            </div>
        </header>

        <!-- Time Range Selector -->
        <div class="time-range-selector">
            <button class="time-btn active" data-period="day">Day</button>
            <button class="time-btn" data-period="week">Week</button>
            <button class="time-btn" data-period="month">Month</button>
        </div>

        <!-- Main Metrics Cards -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-header">
                    <h3>Total Visitors</h3>
                    <span class="trend positive">‚ÜóÔ∏è +12%</span>
                </div>
                <div class="metric-value" id="totalVisitors">0</div>
                <div class="metric-sub">
                    <span id="googleAdsVisitors">üéØ Google Ads Campaign Traffic Only</span>
                </div>
                <div class="metric-chart">
                    <canvas id="visitorsChart"></canvas>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <h3>Total Leads</h3>
                    <span class="trend positive">‚ÜóÔ∏è +8%</span>
                </div>
                <div class="metric-value" id="totalLeads">0</div>
                <div class="metric-sub">
                    <span id="googleAdsLeads">üéØ Google Ads Campaign Leads Only</span>
                </div>
                <div class="metric-chart">
                    <canvas id="leadsChart"></canvas>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <h3>Test Leads</h3>
                    <span class="status-badge test">üß™ Test Submissions</span>
                </div>
                <div class="metric-value" id="totalTestLeads">0</div>
                <div class="metric-sub">
                    <span id="testLeadStatus">Quality Control</span>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <h3>Overall Conversion</h3>
                    <span class="trend positive">‚ÜóÔ∏è +2.1%</span>
                </div>
                <div class="metric-value" id="conversionRate">0%</div>
                <div class="metric-chart">
                    <canvas id="conversionChart"></canvas>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <h3>Total Websites</h3>
                    <span class="status-badge live">üü¢ All Live</span>
                </div>
                <div class="metric-value" id="totalWebsites">0</div>
                <div class="metric-sub">
                    <span id="activeWebsites">0 Active</span>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <h3>Working Forms</h3>
                    <span class="status-badge working">‚úÖ All Working</span>
                </div>
                <div class="metric-value" id="workingForms">0</div>
                <div class="metric-sub">
                    <span id="formStatus">All Working</span>
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="content-grid">
            <!-- Microsite Performance Table -->
            <div class="content-section performance-section">
                <!-- Section Header -->
                <div class="section-header">
                    <div class="section-title">
                        <h2><i class="fas fa-chart-line"></i> Microsite Performance</h2>
                        <p class="section-subtitle">Monitor and analyze your website performance metrics</p>
                    </div>
                    <div class="section-actions">
                        <div class="action-group">
                            <button class="btn-action btn-export" onclick="exportData()">
                                <i class="fas fa-download"></i>
                                <span>Export</span>
                            </button>
                            <button class="btn-action btn-add" onclick="addMicrosite()">
                                <i class="fas fa-plus"></i>
                                <span>Add Site</span>
                            </button>
                            <button class="btn-action btn-load" onclick="loadRealData()">
                                <i class="fas fa-sync-alt"></i>
                                <span>Load Data</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Search and Filter Controls -->
                <div class="controls-container">
                    <!-- Unified Filter Row -->
                    <div class="unified-filter-row">
                        <!-- Combined Search and Region Filter (50%) -->
                        <div class="filter-section combined-section">
                            <div class="control-group combined-filter-group">
                                <div class="filter-row">
                                    <!-- Domain Search -->
                                    <div class="filter-subsection search-subsection">
                                        <div class="control-header">
                                            <i class="fas fa-search"></i>
                                            <h4>Search Websites</h4>
                                        </div>
                                        <div class="search-container">
                                            <div class="search-input-wrapper">
                                                <input type="text" id="domainSearch" class="search-input" placeholder="Search by domain or website name..." onkeyup="filterByDomain()">
                                                <button onclick="clearDomainSearch()" class="search-clear" title="Clear search">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div id="domainSearchStatus" class="search-status" style="display: none;"></div>
                                    </div>

                                    <!-- Region Filter -->
                                    <div class="filter-subsection region-subsection">
                                        <div class="control-header">
                                            <i class="fas fa-map-marker-alt"></i>
                                            <h4>Filter by Region</h4>
                                        </div>
                                        <div class="region-container">
                                            <select id="regionFilter" class="region-select" onchange="filterByRegion()">
                                                <option value="all">All Regions</option>
                                                <option value="navi-mumbai">Navi Mumbai</option>
                                                <option value="thane">Thane</option>
                                                <option value="western-mumbai">Western Mumbai</option>
                                                <option value="soha-harbour">Soha Harbour</option>
                                                <option value="hyderabad">Hyderabad</option>
                                                <option value="pune">Pune</option>
                                                <option value="bangalore">Bangalore</option>
                                                <option value="noida">Noida</option>
                                            </select>
                                            <div class="region-status" id="regionStatus" style="display: none;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Date Range Filter (50%) -->
                        <div class="filter-section date-section">
                            <div class="control-group filter-group">
                                <div class="control-header-with-presets">
                                    <div class="control-header">
                                        <i class="fas fa-calendar-alt"></i>
                                        <h4>Date Range Filter</h4>
                                    </div>
                                    <div class="preset-buttons-inline">
                                        <button onclick="setDatePreset('today')" class="preset-btn active">Today</button>
                                        <button onclick="setDatePreset('yesterday')" class="preset-btn">Yesterday</button>
                                        <button onclick="setDatePreset('week')" class="preset-btn">This Week</button>
                                        <button onclick="setDatePreset('month')" class="preset-btn">This Month</button>
                                    </div>
                                </div>
                                <div class="filter-container">
                                    <div class="date-inputs">
                                        <div class="date-field">
                                            <label for="dateFrom">From</label>
                                            <input type="date" id="dateFrom" class="date-input">
                                        </div>
                                        <div class="date-field">
                                            <label for="dateTo">To</label>
                                            <input type="date" id="dateTo" class="date-input">
                                        </div>
                                    </div>
                                    <div class="filter-actions">
                                        <button onclick="applyDateFilter()" class="btn-filter">
                                            <i class="fas fa-filter"></i>
                                            <span>Apply</span>
                                        </button>
                                        <button onclick="clearDateFilter()" class="btn-clear">
                                            <i class="fas fa-times"></i>
                                            <span>Clear</span>
                                        </button>
                                        <button onclick="exportFilteredData()" class="btn-export-filtered">
                                            <i class="fas fa-download"></i>
                                            <span>Export</span>
                                        </button>
                                    </div>
                                </div>
                                <div id="dateFilterStatus" class="filter-status" style="display: none;"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <div id="tableFilterIndicator" class="table-filter-indicator" style="display: none;">
                        <i class="fas fa-filter"></i>
                        <span>Table filtered by domain search</span>
                        <button onclick="clearDomainSearch()" class="btn-clear-filter" title="Clear filter">
                            <i class="fas fa-times"></i> Clear Filter
                        </button>
                    </div>
                    <table class="performance-table" id="performanceTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Website</th>
                                <th>Visitors</th>
                                <th>Leads</th>
                                <th>Test Leads</th>
                                <th>Conversion %</th>
                                <th>Performance</th>
                                <th>Website Status</th>
                                <th>Form Status</th>
                                <th>Last Activity</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="performanceTableBody">
                            <!-- Dynamic content will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>


            <!-- Alerts & Notifications -->
            <div class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-bell"></i> Alerts & Notifications</h2>
                </div>
                <div class="alerts-container" id="alertsContainer">
                    <div class="no-alerts" id="noAlerts">
                        <i class="fas fa-check-circle"></i>
                        <p>No alerts at this time</p>
                    </div>
                    <div class="alerts-list" id="alertsList" style="display: none;">
                        <!-- Dynamic alerts will be inserted here -->
                    </div>
                </div>
            </div>

            <!-- Live Performance Metrics -->
            <div class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-tachometer-alt"></i> Live Performance Metrics</h2>
                </div>
                <div class="performance-metrics">
                    <div class="perf-metric">
                        <div class="perf-icon">üöÄ</div>
                        <div class="perf-content">
                            <h4>Response Time</h4>
                            <div class="perf-value" id="responseTime">245ms</div>
                            <div class="perf-trend positive">‚ÜóÔ∏è -15ms</div>
                        </div>
                    </div>
                    <div class="perf-metric">
                        <div class="perf-icon">üìä</div>
                        <div class="perf-content">
                            <h4>Uptime</h4>
                            <div class="perf-value" id="uptime">99.9%</div>
                            <div class="perf-trend positive">‚ÜóÔ∏è +0.1%</div>
                        </div>
                    </div>
                    <div class="perf-metric">
                        <div class="perf-icon">üë•</div>
                        <div class="perf-content">
                            <h4>Concurrent Users</h4>
                            <div class="perf-value" id="concurrentUsers">3</div>
                            <div class="perf-trend positive">‚ÜóÔ∏è +12</div>
                        </div>
                    </div>
                    <div class="perf-metric">
                        <div class="perf-icon">üîÑ</div>
                        <div class="perf-content">
                            <h4>Page Load Speed</h4>
                            <div class="perf-value" id="pageLoadSpeed">1.2s</div>
                            <div class="perf-trend positive">‚ÜóÔ∏è -0.3s</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Microsite Modal -->
    <div class="modal" id="addMicrositeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Microsite</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addMicrositeForm">
                    <div class="form-group">
                        <label for="siteName">Site Name</label>
                        <input type="text" id="siteName" required>
                    </div>
                    <div class="form-group">
                        <label for="siteUrl">Site URL</label>
                        <input type="url" id="siteUrl" required>
                    </div>
                    <div class="form-group">
                        <label for="gtmId">GTM Container ID</label>
                        <input type="text" id="gtmId" placeholder="GTM-XXXXXXX" required>
                    </div>
                    <div class="form-group">
                        <label for="formSelector">Form Selector (CSS)</label>
                        <input type="text" id="formSelector" placeholder="#contact-form, .lead-form">
                    </div>
                    <div class="form-group">
                        <label for="conversionGoal">Conversion Goal Name</label>
                        <input type="text" id="conversionGoal" placeholder="Lead Generation">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn-primary" onclick="saveMicrosite()">Add Microsite</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
          <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
          <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
          <script src="api/track.js"></script>
          <script src="real-time-fetcher.js?v=2024.1.9"></script>
          <script src="dashboard.js?v=2024.1.9"></script>
</body>
</html>
