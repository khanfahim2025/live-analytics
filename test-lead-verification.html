<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Lead Verification</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        .test-form { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        input, select { margin: 5px; padding: 5px; }
        #results { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>üß™ Test Lead Detection Verification</h1>
    <p>This page tests the test lead detection system for all websites.</p>
    
    <div class="test-section info">
        <h3>üìä Current Server Status</h3>
        <button onclick="checkServerStatus()">Check Server Status</button>
        <div id="server-status"></div>
    </div>

    <div class="test-section">
        <h3>üè† Homesfy Test Website - Test Lead Detection</h3>
        <p>Testing with GTM ID: GTM-5PHH5D6T</p>
        
        <div class="test-form">
            <h4>Test Form Submission (Should go to Test Leads)</h4>
            <input type="text" id="homesfy-test-name" placeholder="Name" value="test user">
            <input type="email" id="homesfy-test-email" placeholder="Email" value="test@example.com">
            <input type="tel" id="homesfy-test-phone" placeholder="Phone" value="1234567890">
            <button onclick="testHomesfyTestLead()">Submit Test Lead</button>
        </div>
        
        <div class="test-form">
            <h4>Real Form Submission (Should go to Main Leads)</h4>
            <input type="text" id="homesfy-real-name" placeholder="Name" value="John Smith">
            <input type="email" id="homesfy-real-email" placeholder="Email" value="john.smith@gmail.com">
            <input type="tel" id="homesfy-real-phone" placeholder="Phone" value="9876543210">
            <button onclick="testHomesfyRealLead()">Submit Real Lead</button>
        </div>
    </div>

    <div class="test-section">
        <h3>üåø Green Reserve Noida - Test Lead Detection</h3>
        <p>Testing with GTM ID: GTM-GREEN-RESERVE</p>
        
        <div class="test-form">
            <h4>Test Form Submission (Should go to Test Leads)</h4>
            <input type="text" id="green-test-name" placeholder="Name" value="test fahim">
            <input type="email" id="green-test-email" placeholder="Email" value="test@example.com">
            <input type="tel" id="green-test-phone" placeholder="Phone" value="1234567890">
            <button onclick="testGreenTestLead()">Submit Test Lead</button>
        </div>
        
        <div class="test-form">
            <h4>Real Form Submission (Should go to Main Leads)</h4>
            <input type="text" id="green-real-name" placeholder="Name" value="Jane Doe">
            <input type="email" id="green-real-email" placeholder="Email" value="jane.doe@gmail.com">
            <input type="tel" id="green-real-phone" placeholder="Phone" value="9876543210">
            <button onclick="testGreenRealLead()">Submit Real Lead</button>
        </div>
    </div>

    <div class="test-section">
        <h3>üìà Dashboard Verification</h3>
        <button onclick="checkDashboardData()">Check Dashboard Data</button>
        <button onclick="window.open('http://localhost:9000', '_blank')">Open Dashboard</button>
        <div id="dashboard-data"></div>
    </div>

    <div id="results"></div>

    <script>
        // Homesfy Test Website Tracking Script
        (function() {
            'use strict';
            
            const DASHBOARD_CONFIG = {
                gtmId: 'GTM-5PHH5D6T',
                siteName: 'Homesfy Test Website',
                dashboardUrl: 'http://localhost:9000',
                siteUrl: 'https://www.homesfytestwebsite.com'
            };
            
            const sessionId = Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const deviceType = isMobile ? 'mobile' : 'desktop';
            
            function sendToDashboard(eventType, data = {}) {
                const payload = {
                    gtmId: DASHBOARD_CONFIG.gtmId,
                    siteName: DASHBOARD_CONFIG.siteName,
                    siteUrl: DASHBOARD_CONFIG.siteUrl,
                    eventType: eventType,
                    timestamp: Date.now(),
                    url: window.location.href,
                    referrer: document.referrer || '',
                    sessionId: sessionId,
                    isMobile: isMobile,
                    deviceType: deviceType,
                    userAgent: navigator.userAgent,
                    data: data
                };
                
                fetch(`${DASHBOARD_CONFIG.dashboardUrl}/api/receive`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                }).catch(error => console.log('Homesfy tracking error:', error));
            }
            
            // Expose functions globally
            window.homesfyAnalytics = {
                sendEvent: sendToDashboard,
                trackForm: (data) => sendToDashboard('gtm.formSubmit', data),
                trackButton: (data) => sendToDashboard('gtm.buttonClick', data)
            };
            
            // Initialize
            sendToDashboard('gtm.pageView');
        })();

        // Green Reserve Noida Tracking Script
        (function() {
            'use strict';
            
            const DASHBOARD_CONFIG = {
                gtmId: 'GTM-GREEN-RESERVE',
                siteName: 'Green Reserve Noida',
                dashboardUrl: 'http://localhost:9000',
                siteUrl: 'https://green-reserve-noida.in'
            };
            
            const sessionId = Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const deviceType = isMobile ? 'mobile' : 'desktop';
            
            function sendToDashboard(eventType, data = {}) {
                const payload = {
                    gtmId: DASHBOARD_CONFIG.gtmId,
                    siteName: DASHBOARD_CONFIG.siteName,
                    siteUrl: DASHBOARD_CONFIG.siteUrl,
                    eventType: eventType,
                    timestamp: Date.now(),
                    url: window.location.href,
                    referrer: document.referrer || '',
                    sessionId: sessionId,
                    isMobile: isMobile,
                    deviceType: deviceType,
                    userAgent: navigator.userAgent,
                    data: data
                };
                
                fetch(`${DASHBOARD_CONFIG.dashboardUrl}/api/receive`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                }).catch(error => console.log('Green Reserve tracking error:', error));
            }
            
            // Expose functions globally
            window.greenReserveAnalytics = {
                sendEvent: sendToDashboard,
                trackForm: (data) => sendToDashboard('gtm.formSubmit', data),
                trackButton: (data) => sendToDashboard('gtm.buttonClick', data)
            };
            
            // Initialize
            sendToDashboard('gtm.pageView');
        })();

        // Test Functions
        async function checkServerStatus() {
            try {
                const response = await fetch('http://localhost:9000/api/counts.json');
                const data = await response.json();
                document.getElementById('server-status').innerHTML = 
                    `<div class="success">‚úÖ Server is running. Found ${Object.keys(data).length} sites.</div>`;
            } catch (error) {
                document.getElementById('server-status').innerHTML = 
                    `<div class="error">‚ùå Server is not running: ${error.message}</div>`;
            }
        }

        function testHomesfyTestLead() {
            const formData = {
                formId: 'test-form-homesfy',
                formClass: 'test-form',
                formType: 'contact',
                isFormSubmission: true,
                name: document.getElementById('homesfy-test-name').value,
                email: document.getElementById('homesfy-test-email').value,
                phone: document.getElementById('homesfy-test-phone').value
            };
            
            window.homesfyAnalytics.trackForm(formData);
            addResult('üß™ Homesfy Test Lead submitted (should go to Test Leads)', 'info');
        }

        function testHomesfyRealLead() {
            const formData = {
                formId: 'real-form-homesfy',
                formClass: 'real-form',
                formType: 'contact',
                isFormSubmission: true,
                name: document.getElementById('homesfy-real-name').value,
                email: document.getElementById('homesfy-real-email').value,
                phone: document.getElementById('homesfy-real-phone').value
            };
            
            window.homesfyAnalytics.trackForm(formData);
            addResult('‚úÖ Homesfy Real Lead submitted (should go to Main Leads)', 'info');
        }

        function testGreenTestLead() {
            const formData = {
                formId: 'test-form-green',
                formClass: 'test-form',
                formType: 'contact',
                isFormSubmission: true,
                modalFromName: document.getElementById('green-test-name').value,
                modalFromEmail: document.getElementById('green-test-email').value,
                modalFromMobile: document.getElementById('green-test-phone').value
            };
            
            window.greenReserveAnalytics.trackForm(formData);
            addResult('üß™ Green Reserve Test Lead submitted (should go to Test Leads)', 'info');
        }

        function testGreenRealLead() {
            const formData = {
                formId: 'real-form-green',
                formClass: 'real-form',
                formType: 'contact',
                isFormSubmission: true,
                modalFromName: document.getElementById('green-real-name').value,
                modalFromEmail: document.getElementById('green-real-email').value,
                modalFromMobile: document.getElementById('green-real-phone').value
            };
            
            window.greenReserveAnalytics.trackForm(formData);
            addResult('‚úÖ Green Reserve Real Lead submitted (should go to Main Leads)', 'info');
        }

        async function checkDashboardData() {
            try {
                const response = await fetch('http://localhost:9000/api/counts.json');
                const data = await response.json();
                
                let html = '<h4>üìä Current Dashboard Data:</h4>';
                Object.keys(data).forEach(gtmId => {
                    const site = data[gtmId];
                    html += `
                        <div style="margin: 10px 0; padding: 10px; border: 1px solid #ccc;">
                            <strong>${site.siteName}</strong> (${gtmId})<br>
                            Visitors: ${site.visitors || 0} | 
                            Leads: ${site.leads || 0} | 
                            Test Leads: ${site.testLeads || 0}
                        </div>
                    `;
                });
                
                document.getElementById('dashboard-data').innerHTML = html;
            } catch (error) {
                document.getElementById('dashboard-data').innerHTML = 
                    `<div class="error">‚ùå Error fetching dashboard data: ${error.message}</div>`;
            }
        }

        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-section ${type}`;
            div.innerHTML = `${new Date().toLocaleTimeString()}: ${message}`;
            results.appendChild(div);
        }

        // Auto-check server status on load
        window.addEventListener('load', () => {
            checkServerStatus();
            addResult('üöÄ Test page loaded. Ready to test lead detection!', 'success');
        });
    </script>
</body>
</html>
