<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTM Integration Code for Your Microsites</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #4299e1;
            padding-bottom: 10px;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }
        pre {
            margin: 0;
            white-space: pre-wrap;
        }
        .highlight {
            background: #fff3cd;
            padding: 15px;
            border-left: 4px solid #ffc107;
            margin: 20px 0;
        }
        .step {
            background: #e7f3ff;
            padding: 15px;
            border-left: 4px solid #4299e1;
            margin: 15px 0;
        }
        .warning {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-left: 4px solid #dc3545;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîó GTM Integration Code for Your Microsites</h1>
        
        <p>To track your microsites with the Live Analytics Dashboard, add the following code to each of your microsites.</p>

        <div class="highlight">
            <strong>‚ö†Ô∏è Important:</strong> Replace <code>GTM-XXXXXXX</code> with your actual GTM Container ID for each microsite.
        </div>

        <h2>Step 1: Add to Your Website's &lt;head&gt; Section</h2>
        
        <div class="code-block">
            <pre><code>&lt;!-- Live Analytics Dashboard Integration --&gt;
&lt;script&gt;
  // Configuration - UPDATE THESE VALUES
  const DASHBOARD_CONFIG = {
    gtmId: 'GTM-XXXXXXX', // Replace with your GTM Container ID
    siteName: 'Your Site Name', // Replace with your site name
    dashboardUrl: 'https://yourusername.github.io/live-analytics' // Your dashboard URL
  };

  // Send data to dashboard
  function sendToDashboard(eventType, data) {
    const message = {
      event: 'gtm.' + eventType,
      gtmId: DASHBOARD_CONFIG.gtmId,
      siteName: DASHBOARD_CONFIG.siteName,
      data: data,
      timestamp: Date.now(),
      url: window.location.href
    };

    // Send to parent window (if in iframe) or to dashboard
    if (window.parent !== window) {
      window.parent.postMessage(message, '*');
    }
    
    // Also send to dashboard via fetch (for direct tracking)
    fetch(DASHBOARD_CONFIG.dashboardUrl + '/api/track', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(message)
    }).catch(() => {
      // Silently fail if dashboard is not available
    });
  }

  // Track page views
  function trackPageView() {
    sendToDashboard('pageView', {
      page: window.location.pathname,
      title: document.title,
      referrer: document.referrer
    });
  }

  // Track form submissions
  function trackFormSubmission(form) {
    sendToDashboard('formSubmit', {
      formId: form.id || 'unknown',
      formClass: form.className || 'unknown',
      formAction: form.action || 'unknown',
      formMethod: form.method || 'unknown'
    });
  }

  // Track conversions
  function trackConversion(conversionData) {
    sendToDashboard('conversion', {
      conversionType: conversionData.type || 'lead',
      value: conversionData.value || 0,
      currency: conversionData.currency || 'USD',
      goal: conversionData.goal || 'Lead Generation'
    });
  }

  // Initialize tracking
  document.addEventListener('DOMContentLoaded', function() {
    // Track initial page view
    trackPageView();

    // Track all form submissions
    document.addEventListener('submit', function(e) {
      trackFormSubmission(e.target);
    });

    // Track button clicks (for CTA tracking)
    document.addEventListener('click', function(e) {
      if (e.target.matches('button[data-track], a[data-track], input[type="submit"]')) {
        sendToDashboard('buttonClick', {
          elementId: e.target.id || 'unknown',
          elementClass: e.target.className || 'unknown',
          elementText: e.target.textContent || e.target.value || 'unknown',
          elementType: e.target.tagName.toLowerCase()
        });
      }
    });

    // Track scroll depth
    let maxScroll = 0;
    window.addEventListener('scroll', function() {
      const scrollPercent = Math.round((window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100);
      if (scrollPercent > maxScroll) {
        maxScroll = scrollPercent;
        if (maxScroll % 25 === 0) { // Track at 25%, 50%, 75%, 100%
          sendToDashboard('scrollDepth', {
            depth: maxScroll
          });
        }
      }
    });

    // Track time on page
    let startTime = Date.now();
    window.addEventListener('beforeunload', function() {
      const timeOnPage = Math.round((Date.now() - startTime) / 1000);
      sendToDashboard('timeOnPage', {
        seconds: timeOnPage
      });
    });
  });

  // Make functions globally available
  window.trackConversion = trackConversion;
  window.sendToDashboard = sendToDashboard;
&lt;/script&gt;</code></pre>
        </div>

        <h2>Step 2: Add to Your Forms (Optional but Recommended)</h2>
        
        <div class="code-block">
            <pre><code>&lt;!-- Add data-track attribute to buttons you want to track --&gt;
&lt;button type="submit" data-track="true"&gt;Submit Form&lt;/button&gt;
&lt;a href="/contact" data-track="true"&gt;Contact Us&lt;/a&gt;

&lt;!-- Add to your forms for better tracking --&gt;
&lt;form id="contact-form" onsubmit="trackConversion({type: 'lead', value: 50})"&gt;
  &lt;input type="text" name="name" placeholder="Your Name" required&gt;
  &lt;input type="email" name="email" placeholder="Your Email" required&gt;
  &lt;button type="submit" data-track="true"&gt;Send Message&lt;/button&gt;
&lt;/form&gt;</code></pre>
        </div>

        <h2>Step 3: Advanced Tracking (Optional)</h2>
        
        <div class="code-block">
            <pre><code>&lt;script&gt;
  // Track specific events
  function trackCustomEvent(eventName, data) {
    sendToDashboard('customEvent', {
      eventName: eventName,
      data: data
    });
  }

  // Example: Track video plays
  document.addEventListener('play', function(e) {
    if (e.target.tagName === 'VIDEO') {
      trackCustomEvent('videoPlay', {
        videoSrc: e.target.src,
        videoTitle: e.target.title || 'Unknown'
      });
    }
  });

  // Example: Track file downloads
  document.addEventListener('click', function(e) {
    if (e.target.tagName === 'A' && e.target.href.match(/\.(pdf|doc|docx|xls|xlsx|zip)$/)) {
      trackCustomEvent('fileDownload', {
        fileName: e.target.href.split('/').pop(),
        fileType: e.target.href.split('.').pop()
      });
    }
  });
&lt;/script&gt;</code></pre>
        </div>

        <div class="step">
            <h3>üìã Implementation Checklist</h3>
            <ul>
                <li>‚úÖ Replace <code>GTM-XXXXXXX</code with your actual GTM Container ID</li>
                <li>‚úÖ Replace <code>Your Site Name</code> with your actual site name</li>
                <li>‚úÖ Update <code>dashboardUrl</code> with your dashboard URL</li>
                <li>‚úÖ Add the code to the <code>&lt;head&gt;</code> section of all your microsites</li>
                <li>‚úÖ Test the integration by visiting your dashboard</li>
                <li>‚úÖ Add <code>data-track</code> attributes to important buttons and links</li>
            </ul>
        </div>

        <div class="warning">
            <strong>üîí Security Note:</strong> This code sends data to your dashboard. Make sure your dashboard URL is correct and secure. The code includes error handling to prevent issues if the dashboard is unavailable.
        </div>

        <h2>Step 4: Verify Integration</h2>
        
        <p>After adding the code to your microsites:</p>
        <ol>
            <li>Visit your dashboard</li>
            <li>Click "Add Microsite" and add your site details</li>
            <li>Visit your microsite and perform some actions (scroll, click buttons, submit forms)</li>
            <li>Check your dashboard for real-time updates</li>
        </ol>

        <h2>Step 5: Customization</h2>
        
        <p>You can customize the tracking by modifying the <code>DASHBOARD_CONFIG</code> object and adding your own tracking events. The system is designed to be flexible and can track any custom events you need.</p>

        <div class="highlight">
            <strong>üí° Pro Tip:</strong> For better conversion tracking, add the <code>trackConversion()</code> function to your success pages or thank you pages after form submissions.
        </div>
    </div>
</body>
</html>
